<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  卌二、KVM - 笔记仓库
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="笔记仓库" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">笔记仓库</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 笔记仓库</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>1.老男孩学习笔记</label></li>

          
            <li><a title="卅七、zabbix自主监控与分布式监控" href="15053046720339.html">卅七、zabbix自主监控与分布式监控</a></li>
          
            <li><a title="卅六、zabbix自定义监控" href="15053033256965.html">卅六、zabbix自定义监控</a></li>
          
            <li><a title="卅五、centOS6.9部署zabbix" href="15053026350545.html">卅五、centOS6.9部署zabbix</a></li>
          
            <li><a title="卅三、PPTP实现VPN" href="15052974923145.html">卅三、PPTP实现VPN</a></li>
          
            <li><a title="卅四、openvpn安装与使用" href="15052960182182.html">卅四、openvpn安装与使用</a></li>
          
            <li><a title="卅二、NTP时间服务" href="15052921723963.html">卅二、NTP时间服务</a></li>
          
            <li><a title="卅一、Keepalived部署" href="15051477961930.html">卅一、Keepalived部署</a></li>
          
            <li><a title="三十、Nginx应用--反向代理--负载均衡" href="15051475777273.html">三十、Nginx应用--反向代理--负载均衡</a></li>
          
            <li><a title="廿九、数据库迁移--NFS迁移" href="15051466954965.html">廿九、数据库迁移--NFS迁移</a></li>
          
            <li><a title="廿八、MySQL基本操作" href="15051459212797.html">廿八、MySQL基本操作</a></li>
          
            <li><a title="廿七、单台服务器LNMP搭建" href="15051418147758.html">廿七、单台服务器LNMP搭建</a></li>
          
            <li><a title="廿六、Nginx应用--Web服务" href="15051387894730.html">廿六、Nginx应用--Web服务</a></li>
          
            <li><a title="卌二、KVM" href="15050197248657.html">卌二、KVM</a></li>
          
            <li><a title="卌一、CentOS 7" href="15050196529102.html">卌一、CentOS 7</a></li>
          
            <li><a title="四十、自动化安装 (二) -- cobbler" href="15050165021812.html">四十、自动化安装 (二) -- cobbler</a></li>
          
            <li><a title="卅九、自动批量的安装操作系统 -- kickstart" href="15050152527420.html">卅九、自动批量的安装操作系统 -- kickstart</a></li>
          
            <li><a title="卅八、memcache及session共享" href="15049674009290.html">卅八、memcache及session共享</a></li>
          
            <li><a title="廿五、Nginx入门" href="15047113618478.html">廿五、Nginx入门</a></li>
          
            <li><a title="廿四、网站访问相关命令" href="15046800151297.html">廿四、网站访问相关命令</a></li>
          
            <li><a title="廿三、http协议==超文本传输协议" href="15045988807012.html">廿三、http协议==超文本传输协议</a></li>
          
            <li><a title="廿二、ansible" href="15018692235223.html">廿二、ansible</a></li>
          
            <li><a title="廿一、远程连接" href="15018686711597.html">廿一、远程连接</a></li>
          
            <li><a title="廿十、实时同步服务知识介绍(inotify+rsync)" href="15018676996592.html">廿十、实时同步服务知识介绍(inotify+rsync)</a></li>
          
            <li><a title="十五、awk命令精讲" href="15018659093989.html">十五、awk命令精讲</a></li>
          
            <li><a title="十四、网络基础" href="15018658919010.html">十四、网络基础</a></li>
          
            <li><a title="十三、shell编程入门" href="15018640937342.html">十三、shell编程入门</a></li>
          
            <li><a title="十二、sed命令精讲" href="15018613071828.html">十二、sed命令精讲</a></li>
          
            <li><a title="十一、磁盘管理" href="15018474773088.html">十一、磁盘管理</a></li>
          
            <li><a title="十、用户管理" href="15018399397622.html">十、用户管理</a></li>
          
            <li><a title="九、定时任务" href="15018075128546.html">九、定时任务</a></li>
          
            <li><a title="七、文件属性" href="15017626488369.html">七、文件属性</a></li>
          
            <li><a title="五、Linux基础优化" href="15017614116406.html">五、Linux基础优化</a></li>
          
            <li><a title="八、Linux权限体系" href="15017603199663.html">八、Linux权限体系</a></li>
          
            <li><a title="十九、期中架构NFS知识讲解" href="15013159711138.html">十九、期中架构NFS知识讲解</a></li>
          
            <li><a title="十八、全网备份" href="15013155594594.html">十八、全网备份</a></li>
          
            <li><a title="十七、rsync课程讲解" href="15012425054241.html">十七、rsync课程讲解</a></li>
          
            <li><a title="十六、期中架构" href="15012368281486.html">十六、期中架构</a></li>
          
            <li><a title="六、目录结构" href="15010772533002.html">六、目录结构</a></li>
          
            <li><a title="四、远程连接排错" href="15010763542152.html">四、远程连接排错</a></li>
          
            <li><a title="一、计算机系统硬件核心知识" href="15010712824389.html">一、计算机系统硬件核心知识</a></li>
          
            <li><a title="二、Linux的发展过程与核心知识" href="15010697787307.html">二、Linux的发展过程与核心知识</a></li>
          

      
        <li class="divider"></li>
        <li><label>2.十五个必会的原理知识</label></li>

          
            <li><a title="15. 描述你维护过的大规模集群网站架构的设计原理" href="15010702959683.html">15. 描述你维护过的大规模集群网站架构的设计原理</a></li>
          
            <li><a title="14. 详细描述Linux权限管理体系" href="15010702850667.html">14. 详细描述Linux权限管理体系</a></li>
          
            <li><a title="13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理" href="15010702778892.html">13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理</a></li>
          
            <li><a title="12. 一致性哈西算法作用及原理" href="15010702692268.html">12. 一致性哈西算法作用及原理</a></li>
          
            <li><a title="11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择" href="15010702612275.html">11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择</a></li>
          
            <li><a title="10. Linux默认文件系统,文件删除原理" href="15010702550739.html">10. Linux默认文件系统,文件删除原理</a></li>
          
            <li><a title="09. 详细描述CDN工作原理以及购买服务后解析操作步骤" href="15010702488190.html">09. 详细描述CDN工作原理以及购买服务后解析操作步骤</a></li>
          
            <li><a title="08. keepalive高可用服务工作原理" href="15010702422822.html">08. keepalive高可用服务工作原理</a></li>
          
            <li><a title="07. memcached工作原理(内存管理机制)" href="15010702209182.html">07. memcached工作原理(内存管理机制)</a></li>
          
            <li><a title="06. lvs的4种模式工作原理" href="15010702152705.html">06. lvs的4种模式工作原理</a></li>
          
            <li><a title="05. Nginx配合PHP工作fastcgi工作原理" href="15010702085430.html">05. Nginx配合PHP工作fastcgi工作原理</a></li>
          
            <li><a title="04. MySQL主从同步原理" href="15010701999479.html">04. MySQL主从同步原理</a></li>
          
            <li><a title="03. TCP/IP的三次握手和四次挥手原理" href="15010701936255.html">03. TCP/IP的三次握手和四次挥手原理</a></li>
          
            <li><a title="02. http协议通信原理" href="15010701867065.html">02. http协议通信原理</a></li>
          
            <li><a title="01. DNS系统架构与解析原理" href="15010701752650.html">01. DNS系统架构与解析原理</a></li>
          

      
        <li class="divider"></li>
        <li><label>3.命令总结</label></li>

          
            <li><a title="inotifywait" href="15017603290224.html">inotifywait</a></li>
          
            <li><a title="Linux命令总结 (持续更新中)" href="15013198329902.html">Linux命令总结 (持续更新中)</a></li>
          

      
        <li class="divider"></li>
        <li><label>零散笔记</label></li>

          
            <li><a title="redis简单入门及实现wordpress数据库缓存" href="15052628837678.html">redis简单入门及实现wordpress数据库缓存</a></li>
          
            <li><a title="Linux下获取公网IP地址的方法" href="15051981760993.html">Linux下获取公网IP地址的方法</a></li>
          
            <li><a title="附录: 502和504错误" href="15051451335516.html">附录: 502和504错误</a></li>
          
            <li><a title="HTTP状态码列表" href="15021542293136.html">HTTP状态码列表</a></li>
          
            <li><a title="Ansible常用模块汇总" href="15021011169868.html">Ansible常用模块汇总</a></li>
          
            <li><a title="web服务基础" href="15020372614069.html">web服务基础</a></li>
          
            <li><a title="全网备份案例" href="15010886029579.html">全网备份案例</a></li>
          
            <li><a title="xinetd服务管理器" href="15010578989827.html">xinetd服务管理器</a></li>
          
            <li><a title="服务器简单优化" href="15010516186972.html">服务器简单优化</a></li>
          

      
        <li class="divider"></li>
        <li><label>考试题</label></li>

          
            <li><a title="期中架构之前复习考试" href="15013178849284.html">期中架构之前复习考试</a></li>
          

      
        <li class="divider"></li>
        <li><label>心情随笔</label></li>

          
            <li><a title="鸡汤" href="15050925305457.html">鸡汤</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>1.老男孩学习笔记</span></li>
                        
                          <li><a title="卅七、zabbix自主监控与分布式监控" href="15053046720339.html">卅七、zabbix自主监控与分布式监控</a></li>
                        
                          <li><a title="卅六、zabbix自定义监控" href="15053033256965.html">卅六、zabbix自定义监控</a></li>
                        
                          <li><a title="卅五、centOS6.9部署zabbix" href="15053026350545.html">卅五、centOS6.9部署zabbix</a></li>
                        
                          <li><a title="卅三、PPTP实现VPN" href="15052974923145.html">卅三、PPTP实现VPN</a></li>
                        
                          <li><a title="卅四、openvpn安装与使用" href="15052960182182.html">卅四、openvpn安装与使用</a></li>
                        
                          <li><a title="卅二、NTP时间服务" href="15052921723963.html">卅二、NTP时间服务</a></li>
                        
                          <li><a title="卅一、Keepalived部署" href="15051477961930.html">卅一、Keepalived部署</a></li>
                        
                          <li><a title="三十、Nginx应用--反向代理--负载均衡" href="15051475777273.html">三十、Nginx应用--反向代理--负载均衡</a></li>
                        
                          <li><a title="廿九、数据库迁移--NFS迁移" href="15051466954965.html">廿九、数据库迁移--NFS迁移</a></li>
                        
                          <li><a title="廿八、MySQL基本操作" href="15051459212797.html">廿八、MySQL基本操作</a></li>
                        
                          <li><a title="廿七、单台服务器LNMP搭建" href="15051418147758.html">廿七、单台服务器LNMP搭建</a></li>
                        
                          <li><a title="廿六、Nginx应用--Web服务" href="15051387894730.html">廿六、Nginx应用--Web服务</a></li>
                        
                          <li><a title="卌二、KVM" href="15050197248657.html">卌二、KVM</a></li>
                        
                          <li><a title="卌一、CentOS 7" href="15050196529102.html">卌一、CentOS 7</a></li>
                        
                          <li><a title="四十、自动化安装 (二) -- cobbler" href="15050165021812.html">四十、自动化安装 (二) -- cobbler</a></li>
                        
                          <li><a title="卅九、自动批量的安装操作系统 -- kickstart" href="15050152527420.html">卅九、自动批量的安装操作系统 -- kickstart</a></li>
                        
                          <li><a title="卅八、memcache及session共享" href="15049674009290.html">卅八、memcache及session共享</a></li>
                        
                          <li><a title="廿五、Nginx入门" href="15047113618478.html">廿五、Nginx入门</a></li>
                        
                          <li><a title="廿四、网站访问相关命令" href="15046800151297.html">廿四、网站访问相关命令</a></li>
                        
                          <li><a title="廿三、http协议==超文本传输协议" href="15045988807012.html">廿三、http协议==超文本传输协议</a></li>
                        
                          <li><a title="廿二、ansible" href="15018692235223.html">廿二、ansible</a></li>
                        
                          <li><a title="廿一、远程连接" href="15018686711597.html">廿一、远程连接</a></li>
                        
                          <li><a title="廿十、实时同步服务知识介绍(inotify+rsync)" href="15018676996592.html">廿十、实时同步服务知识介绍(inotify+rsync)</a></li>
                        
                          <li><a title="十五、awk命令精讲" href="15018659093989.html">十五、awk命令精讲</a></li>
                        
                          <li><a title="十四、网络基础" href="15018658919010.html">十四、网络基础</a></li>
                        
                          <li><a title="十三、shell编程入门" href="15018640937342.html">十三、shell编程入门</a></li>
                        
                          <li><a title="十二、sed命令精讲" href="15018613071828.html">十二、sed命令精讲</a></li>
                        
                          <li><a title="十一、磁盘管理" href="15018474773088.html">十一、磁盘管理</a></li>
                        
                          <li><a title="十、用户管理" href="15018399397622.html">十、用户管理</a></li>
                        
                          <li><a title="九、定时任务" href="15018075128546.html">九、定时任务</a></li>
                        
                          <li><a title="七、文件属性" href="15017626488369.html">七、文件属性</a></li>
                        
                          <li><a title="五、Linux基础优化" href="15017614116406.html">五、Linux基础优化</a></li>
                        
                          <li><a title="八、Linux权限体系" href="15017603199663.html">八、Linux权限体系</a></li>
                        
                          <li><a title="十九、期中架构NFS知识讲解" href="15013159711138.html">十九、期中架构NFS知识讲解</a></li>
                        
                          <li><a title="十八、全网备份" href="15013155594594.html">十八、全网备份</a></li>
                        
                          <li><a title="十七、rsync课程讲解" href="15012425054241.html">十七、rsync课程讲解</a></li>
                        
                          <li><a title="十六、期中架构" href="15012368281486.html">十六、期中架构</a></li>
                        
                          <li><a title="六、目录结构" href="15010772533002.html">六、目录结构</a></li>
                        
                          <li><a title="四、远程连接排错" href="15010763542152.html">四、远程连接排错</a></li>
                        
                          <li><a title="一、计算机系统硬件核心知识" href="15010712824389.html">一、计算机系统硬件核心知识</a></li>
                        
                          <li><a title="二、Linux的发展过程与核心知识" href="15010697787307.html">二、Linux的发展过程与核心知识</a></li>
                        

                    
                      <li class="side-title"><span>2.十五个必会的原理知识</span></li>
                        
                          <li><a title="15. 描述你维护过的大规模集群网站架构的设计原理" href="15010702959683.html">15. 描述你维护过的大规模集群网站架构的设计原理</a></li>
                        
                          <li><a title="14. 详细描述Linux权限管理体系" href="15010702850667.html">14. 详细描述Linux权限管理体系</a></li>
                        
                          <li><a title="13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理" href="15010702778892.html">13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理</a></li>
                        
                          <li><a title="12. 一致性哈西算法作用及原理" href="15010702692268.html">12. 一致性哈西算法作用及原理</a></li>
                        
                          <li><a title="11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择" href="15010702612275.html">11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择</a></li>
                        
                          <li><a title="10. Linux默认文件系统,文件删除原理" href="15010702550739.html">10. Linux默认文件系统,文件删除原理</a></li>
                        
                          <li><a title="09. 详细描述CDN工作原理以及购买服务后解析操作步骤" href="15010702488190.html">09. 详细描述CDN工作原理以及购买服务后解析操作步骤</a></li>
                        
                          <li><a title="08. keepalive高可用服务工作原理" href="15010702422822.html">08. keepalive高可用服务工作原理</a></li>
                        
                          <li><a title="07. memcached工作原理(内存管理机制)" href="15010702209182.html">07. memcached工作原理(内存管理机制)</a></li>
                        
                          <li><a title="06. lvs的4种模式工作原理" href="15010702152705.html">06. lvs的4种模式工作原理</a></li>
                        
                          <li><a title="05. Nginx配合PHP工作fastcgi工作原理" href="15010702085430.html">05. Nginx配合PHP工作fastcgi工作原理</a></li>
                        
                          <li><a title="04. MySQL主从同步原理" href="15010701999479.html">04. MySQL主从同步原理</a></li>
                        
                          <li><a title="03. TCP/IP的三次握手和四次挥手原理" href="15010701936255.html">03. TCP/IP的三次握手和四次挥手原理</a></li>
                        
                          <li><a title="02. http协议通信原理" href="15010701867065.html">02. http协议通信原理</a></li>
                        
                          <li><a title="01. DNS系统架构与解析原理" href="15010701752650.html">01. DNS系统架构与解析原理</a></li>
                        

                    
                      <li class="side-title"><span>3.命令总结</span></li>
                        
                          <li><a title="inotifywait" href="15017603290224.html">inotifywait</a></li>
                        
                          <li><a title="Linux命令总结 (持续更新中)" href="15013198329902.html">Linux命令总结 (持续更新中)</a></li>
                        

                    
                      <li class="side-title"><span>零散笔记</span></li>
                        
                          <li><a title="redis简单入门及实现wordpress数据库缓存" href="15052628837678.html">redis简单入门及实现wordpress数据库缓存</a></li>
                        
                          <li><a title="Linux下获取公网IP地址的方法" href="15051981760993.html">Linux下获取公网IP地址的方法</a></li>
                        
                          <li><a title="附录: 502和504错误" href="15051451335516.html">附录: 502和504错误</a></li>
                        
                          <li><a title="HTTP状态码列表" href="15021542293136.html">HTTP状态码列表</a></li>
                        
                          <li><a title="Ansible常用模块汇总" href="15021011169868.html">Ansible常用模块汇总</a></li>
                        
                          <li><a title="web服务基础" href="15020372614069.html">web服务基础</a></li>
                        
                          <li><a title="全网备份案例" href="15010886029579.html">全网备份案例</a></li>
                        
                          <li><a title="xinetd服务管理器" href="15010578989827.html">xinetd服务管理器</a></li>
                        
                          <li><a title="服务器简单优化" href="15010516186972.html">服务器简单优化</a></li>
                        

                    
                      <li class="side-title"><span>考试题</span></li>
                        
                          <li><a title="期中架构之前复习考试" href="15013178849284.html">期中架构之前复习考试</a></li>
                        

                    
                      <li class="side-title"><span>心情随笔</span></li>
                        
                          <li><a title="鸡汤" href="15050925305457.html">鸡汤</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>卌二、KVM</h1>

<ol>
<li><p>为什么需要KVM</p>

<blockquote>
<p>云计算，OpenStack， 亚马逊<br/>
底层采用KVM，其他xen、docker，esxi<br/>
openstack类似cobbler，</p>

<blockquote>
<p>cobbler给kickstart提供web界面<br/>
    OpenStack给KVM提供web界面管理</p>
</blockquote>

<p>企业使用虚拟化要么就是kvm要么就是docker</p>
</blockquote>

<blockquote>
<p>最开始：没钱，全都用软件<br/>
公司有钱：买硬件<br/>
特别有钱：大部分使用软件</p>
</blockquote></li>
<li><p>技术演变</p>

<ol>
<li><p>软件模拟</p>

<blockquote>
<p>软件模拟，理论上可以模拟任何硬件，甚至是不存在的硬件。但是因为这种方式全部是软件模拟硬件，所以非常低效，一般只用于研究测试的场景。采用这种技术的典型产品有Bochs、 QEMU等。</p>
</blockquote></li>
<li><p>虚拟化层翻译</p>

<blockquote>
<p>1.2.1  软件全虚拟化：软件捕获翻译    ========》你和美国人说话需要一个翻译官<br/>
    VMware，有一个专门虚拟化引擎。通过虚拟化引擎，捕获虚拟机的指令，并进行处理，这也是为什么在虚拟机上虽然使用的是物理机一样的指令，但是虚拟机不能对硬件进行操作的原因，比如重启虚拟机不会引起宿主机的重启。这种解决方案也叫软件全虚拟化方案。</p>
</blockquote>

<blockquote>
<p>1.2.2  半虚拟化：改造虚拟机系统内核加虚拟化层翻译  ====》你学了英语和美国人说话<br/>
    xen，对虚拟机的操作系统内核进行改造，使虚拟机自己对特殊的指令进   行更改，然后和虚拟化层一起配合工作，这也是Xen早期一直要使用一个特殊内核的原因，并且不支持Windows系统虚拟化。改造的虚拟机虽然使用上有限制，配置比较麻烦，但是这种方式效率非常高，这种方式也被称为半虚拟化方案。</p>
</blockquote>

<blockquote>
<p>1.2.3  硬件支持的全虚拟化： 硬件支持的虚拟化层翻译 ==》你重生到美国然后和美国人说话<br/>
    2005年， Intel推出了硬件的方案，对CPU指令进行改造，即VT-x。 这种方案因为是基于硬件的，所以效率非常高，这种方案也称为硬件支持的全虚拟化方案。</p>
</blockquote></li>
<li><p>容器虚拟化</p>

<blockquote>
<p>kvm是在操作系统上安装了另外一个操作系统<br/>
docker是在操作系统上启动一个程序</p>
</blockquote>

<blockquote>
<p>容器虚拟化的原理是基于CGroups、 Namespace等技术将进程隔离，每个进程就像一台单独的虚拟机一样，有自己被隔离出来的资源，也有自己的根目录、独立的进程编号、被隔离的内存空间。基于容器的虚拟化可以实现在单一内核上运行多个实例，因此是一个更高效率的虚拟化方式。目前最热的容器虚拟化技术就是Docker。</p>
</blockquote>

<blockquote>
<p>比喻：一个新建的大楼的某层，如果将他改建成住宅，那就需要每个房间都要有厨房，浴室等正常人家必备设施，一层楼估计能做出3户人家；但是改建成宿舍，什么厨房，浴室就建一个就可以，然后每个宿舍的墙可以打个隔断，很节省资源，基本可以隔出20个。</p>
</blockquote></li>
<li><p>使用场景：</p>

<blockquote>
<p>虚拟化使用场景：对资源要求不高的服务，负载均衡，web服务</p>

<p>数据库，NFS存储对IO资源强烈需求的不建议使用虚拟化</p>
</blockquote></li>
</ol></li>
<li><p>KVM简介</p>

<ol>
<li><p>KVM简介<br/>
<strong><mark>KVM(Kernel-based Virtual Machine)</mark></strong></p>

<blockquote>
<p><img src="http://ovt17vn7k.bkt.clouddn.com/17-9-10/4181648.jpg" alt=""/></p>
</blockquote>

<p>虚拟化嵌套</p>

<blockquote>
<p><img src="http://ovt17vn7k.bkt.clouddn.com/17-9-10/92932098.jpg" alt=""/><br/>
KVM虚拟机=KVM内核模块+QEMU模拟器</p>

<p>KVM只是个内核模块，只提供CPU和内存。所以还使用qemu模拟器模拟IO设备如磁盘、网卡。</p>
</blockquote>

<blockquote>
<p>Libvirt是一套开源的虚拟化的管理工具，主要由3部分组成：<br/>
    一套API的lib库，支持主流的编程语言，包括C、Python、Ruby 等<br/>
    Libvirtd服务<br/>
    命令行工具virsh<br/>
Libvirt可以实现对虚拟机的管理，比如虚拟机的创建、启动、关闭、暂停、恢复、迁移、销毁，以及虚拟机网卡、硬盘、 CPU、内存等多种设备的热添加。</p>
</blockquote></li>
</ol></li>
<li><p>KVM安装</p>

<ol>
<li><p>环境检查</p>

<blockquote>
<p><img src="http://ovt17vn7k.bkt.clouddn.com/17-9-10/56943339.jpg" alt=""/></p>

<pre><code>[root@oldboyedu ~]# cat /etc/redhat-release
CentOS Linux release 7.2.1511 (Core) 
[root@oldboyedu ~]# uname -r
3.10.0-327.el7.x86_64
[root@oldboyedu ~]# systemctl status firewalld.service 
● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)
   Active: inactive (dead)
[root@oldboyedu ~]# getenforce 
Disabled
[root@oldboyedu ~]# hostname -I
10.0.0.201 172.16.1.201 192.168.122.1 
[root@oldboyedu ~]# lsmod |grep kvm
kvm_intel             162153  0 
kvm                   525259  1 kvm_intel
[root@oldboyedu ~]# grep -Eo &#39;(vmx|svm)&#39; /proc/cpuinfo
vmx
</code></pre>
</blockquote></li>
<li><p>安装管理工具</p>

<blockquote>
<pre><code>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
yum -y install qemu-kvm qemu-kvm-tools virt-manager libvirt virt-install 
</code></pre>

<p>安装软件包详细说明</p>

<pre><code>[root@KVM ~]# rpm -qa|grep -E &#39;qemu|libvirt|virt&#39;
python-virtinst-0.600.0-29.el6.noarch   # 一套Python的虚拟机安装工具
gpxe-roms-qemu-0.9.7-6.14.el6.noarch    # 虚拟机iPXE的启动固件，支持虚拟机从网络启动
virt-manager-0.9.0-29.el6.x86_64        # 基于Libvirt的图像化虚拟机管理软件，需要图形界面操作系统
qemu-img-0.12.1.2-2.479.el6.x86_64      # 用于操作虚拟机硬盘镜像的创建、查看和格式转化
libvirt-python-0.10.2-54.el6.x86_64     # libvirt为Python提供的API
qemu-kvm-0.12.1.2-2.479.el6.x86_64      # KVM在用户空间运行的程序
qemu-kvm-tools-0.12.1.2-2.479.el6.x86_64
libvirt-0.10.2-54.el6.x86_64            # 用于管理虚拟机，它提供了一套虚拟机操作API
libvirt-client-0.10.2-54.el6.x86_64     # Libvirt的客户端，最重要的功能之一就是就在宿主机关机时可以通知虚拟机也关机，使虚拟机系统正常关机，而不是被强制关机，造成数据丢失
virt-top-1.0.4-3.15.el6.x86_64          # 类似于top命令，查看虚拟机的资源使用情况
virt-what-1.11-1.2.el6.x86_64           # 在虚拟机内部执行，查看虚拟机运行的虚拟化平台
virt-viewer-0.5.6-8.el6.x86_64          # 显示虚拟机的控制台console
</code></pre>
</blockquote></li>
</ol></li>
<li><p>安装KVM虚拟机</p>

<ol>
<li><p>创建磁盘文件</p>

<pre><code>mkdir -p /application/kvm_data
cd /application/kvm_data
qemu-img create -f qcow2 /application/kvm_data/moban.qcow2 20G
</code></pre>

<p>查看虚拟机磁盘的信息</p>

<pre><code>[root@oldboyedu kvm_data]# qemu-img info /application/kvm_data/moban.qcow2
image: /application/kvm_data/moban.qcow2
file format: qcow2
virtual size: 20G (21474836480 bytes)
disk size: 196K
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
</code></pre></li>
<li><p>执行安装命令（包括上传系统镜像）</p>

<pre><code>virt-install --virt-type=kvm --name=c72-moban --vcpus=1 -r 1024 -c /application/tools/CentOS7_2.iso --network network=default --graphics vnc,listen=0.0.0.0 --noautoconsole --os-type=linux --os-variant=rhel7 --disk path=/application/kvm_data/moban.qcow2,size=20,format=qcow2
</code></pre>

<p>安装其他虚拟机需要变动的两处：</p>

<pre><code>virt-install --virt-type=kvm --name=xxxxxx --vcpus=1 -r 1024 -c /application/tools/CentOS7_2.iso --network network=default --graphics vnc,listen=0.0.0.0 --noautoconsole --os-type=linux --os-variant=rhel7 --disk path=/application/kvm_data/xxxx.qcow2,size=20,format=qcow2
</code></pre>

<p><em>小知识：</em><br/>
<em>KVM网络默认是NAT模式</em></p>

<p><em>dnsmasq既提供dns解析服务还提供DHCP服务</em></p></li>
<li><p>管理KVM的操作命令</p>

<p>5.3.1 查看KVM虚拟机</p>

<pre><code>[root@oldboyedu kvm_data]# virsh list
 Id    名称                         状态
----------------------------------------------------

[root@oldboyedu kvm_data]# virsh list --all
 Id    名称                         状态
----------------------------------------------------
 -     c72-moban                      关闭
</code></pre>

<p>5.3.2 启动、关闭</p>

<pre><code>[root@oldboyedu kvm_data]# virsh start c72-moban 
域 c72-moban 已开始

正常关闭：virsh shutdown c72-moban 
暴力关机：virsh destroy c72-moban

当然还可以在kvm虚拟机里面执行poweroff
</code></pre>

<p>5.3.3 连接端口</p>

<pre><code>vnc的默认端口5900
如果再安装或者启动一台新的虚拟机，端口就是5901  ==10.0.0.201:5901
如果再安装或者启动一台新的虚拟机，端口就是5902  ==10.0.0.201:5902
…………

[root@oldboyedu kvm_data]# netstat -tunlp|grep 5900
tcp        0      0 0.0.0.0:5900            0.0.0.0:*               LISTEN      3838/qemu-kvm       
[root@oldboyedu kvm_data]# ps -ef|grep 3838
qemu       3838      1 16 11:39 ?        00:01:02 /usr/libexec/qemu-kvm -name c72-moban -S -machine pc-i440fx-rhel7.0.0,accel=kvm,usb=off -cpu Haswell,-hle,-rtm -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 4453daa6-14d3-4a4c-93e1-ccfced1340f4 -no-user-config …………nc 0.0.0.0:0 -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on
</code></pre>

<p>5.3.4 查看虚拟机的信息</p>

<pre><code>lscpu查看虚拟机的cpu信息

L1d  一级数据缓存
L1i  一级指令缓存
</code></pre>

<p>5.3.5 查看宿主机网卡桥接信息</p>

<pre><code>[root@oldboyedu kvm_data]# brctl show
bridge name bridge id       STP enabled interfaces
virbr0      8000.fe5400b37bac   yes     vnet0
</code></pre>

<p>5.3.6 常用命令汇总    </p>

<blockquote>
<p>生成kvm虚拟机：virt-install<br/>
查看在运行的虚拟机：virsh list<br/>
查看所有虚拟机：virsh list --all<br/>
查看kvm虚拟机配置文件：virsh dumpxml name<br/>
启动kvm虚拟机：virsh start name<br/>
正常关机：virsh shutdown name <br/>
非正常关机（相当于物理机直接拔掉电源）：virsh destroy name<br/>
删除：virsh undefine name（彻底删除，找不回来了，如果想找回来，需要备份/etc/libvirt/qemu的xml文件）<br/>
根据配置文件定义虚拟机：virsh define file-name.xml<br/>
挂起，终止：virsh suspend name<br/>
恢复挂起状态:virsh resume name</p>
</blockquote></li>
</ol></li>
<li><p>磁盘文件格式介绍</p>

<p><a href="http://www.cnblogs.com/feisky/archive/2012/07/03/2575167.html">http://www.cnblogs.com/feisky/archive/2012/07/03/2575167.html</a></p>

<p>主流使用qcow2</p></li>
<li><p>克隆</p>

<ol>
<li><p>复制磁盘文件</p>

<pre><code>[root@oldboyedu kvm_data]# pwd
/application/kvm_data
[root@oldboyedu kvm_data]# ls
moban.qcow2
[root@oldboyedu kvm_data]# cp moban.qcow2 clone.qcow2
</code></pre></li>
<li><p>导出模板机的配置文件并修改</p>

<p>导出模板机的配置</p>

<pre><code>virsh dumpxml c72-moban &gt; clone.xml
cp clone.xml{,.ori}
</code></pre>

<p>第2,3,37,82修改</p>

<pre><code>[root@oldboyedu ~]# diff clone.xml{,.ori}
2,3c2,3
&lt;   &lt;name&gt;c72-clone&lt;/name&gt;
&lt;   &lt;uuid&gt;4453daf6-14d3-4a4c-93e1-ccfced1340f4&lt;/uuid&gt;
---
&gt;   &lt;name&gt;c72-moban&lt;/name&gt;
&gt;   &lt;uuid&gt;4453daa6-14d3-4a4c-93e1-ccfced1340f4&lt;/uuid&gt;
37c37
&lt;       &lt;source file=&#39;/application/kvm_data/clone.qcow2&#39;/&gt;
---
&gt;       &lt;source file=&#39;/application/kvm_data/moban.qcow2&#39;/&gt;
82c82
&lt;       &lt;mac address=&#39;52:54:00:b3:72:ac&#39;/&gt;
---
&gt;       &lt;mac address=&#39;52:54:00:b3:7b:ac&#39;/&gt;
</code></pre></li>
<li><p>导入新的克隆机器</p>

<p>默认kvm的配置文件</p>

<pre><code>[root@oldboyedu ~]# ls /etc/libvirt/qemu
c72-moban.xml  networks
</code></pre>

<p>导入</p>

<pre><code>[root@oldboyedu ~]# virsh define clone.xml
Domain c72-clone defined from clone.xml
</code></pre>

<p>再次查看</p>

<pre><code>[root@oldboyedu ~]# ls /etc/libvirt/qemu
c72-clone.xml  c72-moban.xml  networks
[root@oldboyedu ~]# virsh list --all
 Id    Name                           State
----------------------------------------------------
 2     c72-moban                      running
 -     c72-clone                      shut off
</code></pre></li>
</ol></li>
<li><p>快照</p>

<ol>
<li>创建快照注意事项</li>
</ol>

<blockquote>
<p>磁盘格式要为qcow2<br/>
关机做快照最好，开机也能做快照</p>
</blockquote>

<ol>
<li><p>快照命令</p>

<p>创建快照</p>

<pre><code>virsh snapshot-create-as c72-clone    kuaizhao1
命令   创建快照指令         虚拟机名称     快照名称
</code></pre>

<p>查看快照列表</p>

<pre><code>virsh snapshot-list      c72-clone
命令   查看快照列表指令      虚拟机名称
</code></pre>

<p>查看快照信息</p>

<pre><code>virsh snapshot-info       c72-clone    kuaizhao1
命令   查看指定快照信息指令   虚拟机名称      快照名称
</code></pre>

<p>还原</p>

<pre><code>virsh snapshot-revert     c72-clone    kuaizhao1
命令   还原指定快照指令       虚拟机名称     快照名称
</code></pre>

<p>删除快照</p>

<pre><code>virsh snapshot-delete     c72-clone    kuaizhao1
命令   删除指定快照指令       虚拟机名称     快照名称
</code></pre></li>
</ol></li>
<li><p>图形化管理KVM</p></li>
</ol>

<blockquote>
<h1 id="toc_0">今日总结：</h1>

<ol>
<li>KVM安装</li>
<li>克隆</li>
<li>快照</li>
</ol>
</blockquote>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15050925305457.html"  title="Previous Post: 鸡汤">&laquo; 鸡汤</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15050196529102.html" 
	        title="Next Post: 卌一、CentOS 7">卌一、CentOS 7 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15050197248657.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
