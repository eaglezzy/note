<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  廿六、Nginx应用--Web服务 - 笔记仓库
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="笔记仓库" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">笔记仓库</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 笔记仓库</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>1.老男孩学习笔记</label></li>

          
            <li><a title="卅七、zabbix自主监控与分布式监控" href="15053046720339.html">卅七、zabbix自主监控与分布式监控</a></li>
          
            <li><a title="卅六、zabbix自定义监控" href="15053033256965.html">卅六、zabbix自定义监控</a></li>
          
            <li><a title="卅五、centOS6.9部署zabbix" href="15053026350545.html">卅五、centOS6.9部署zabbix</a></li>
          
            <li><a title="卅三、PPTP实现VPN" href="15052974923145.html">卅三、PPTP实现VPN</a></li>
          
            <li><a title="卅四、openvpn安装与使用" href="15052960182182.html">卅四、openvpn安装与使用</a></li>
          
            <li><a title="卅二、NTP时间服务" href="15052921723963.html">卅二、NTP时间服务</a></li>
          
            <li><a title="卅一、Keepalived部署" href="15051477961930.html">卅一、Keepalived部署</a></li>
          
            <li><a title="三十、Nginx应用--反向代理--负载均衡" href="15051475777273.html">三十、Nginx应用--反向代理--负载均衡</a></li>
          
            <li><a title="廿九、数据库迁移--NFS迁移" href="15051466954965.html">廿九、数据库迁移--NFS迁移</a></li>
          
            <li><a title="廿八、MySQL基本操作" href="15051459212797.html">廿八、MySQL基本操作</a></li>
          
            <li><a title="廿七、单台服务器LNMP搭建" href="15051418147758.html">廿七、单台服务器LNMP搭建</a></li>
          
            <li><a title="廿六、Nginx应用--Web服务" href="15051387894730.html">廿六、Nginx应用--Web服务</a></li>
          
            <li><a title="卌二、KVM" href="15050197248657.html">卌二、KVM</a></li>
          
            <li><a title="卌一、CentOS 7" href="15050196529102.html">卌一、CentOS 7</a></li>
          
            <li><a title="四十、自动化安装 (二) -- cobbler" href="15050165021812.html">四十、自动化安装 (二) -- cobbler</a></li>
          
            <li><a title="卅九、自动批量的安装操作系统 -- kickstart" href="15050152527420.html">卅九、自动批量的安装操作系统 -- kickstart</a></li>
          
            <li><a title="卅八、memcache及session共享" href="15049674009290.html">卅八、memcache及session共享</a></li>
          
            <li><a title="廿五、Nginx入门" href="15047113618478.html">廿五、Nginx入门</a></li>
          
            <li><a title="廿四、网站访问相关命令" href="15046800151297.html">廿四、网站访问相关命令</a></li>
          
            <li><a title="廿三、http协议==超文本传输协议" href="15045988807012.html">廿三、http协议==超文本传输协议</a></li>
          
            <li><a title="廿二、ansible" href="15018692235223.html">廿二、ansible</a></li>
          
            <li><a title="廿一、远程连接" href="15018686711597.html">廿一、远程连接</a></li>
          
            <li><a title="廿十、实时同步服务知识介绍(inotify+rsync)" href="15018676996592.html">廿十、实时同步服务知识介绍(inotify+rsync)</a></li>
          
            <li><a title="十五、awk命令精讲" href="15018659093989.html">十五、awk命令精讲</a></li>
          
            <li><a title="十四、网络基础" href="15018658919010.html">十四、网络基础</a></li>
          
            <li><a title="十三、shell编程入门" href="15018640937342.html">十三、shell编程入门</a></li>
          
            <li><a title="十二、sed命令精讲" href="15018613071828.html">十二、sed命令精讲</a></li>
          
            <li><a title="十一、磁盘管理" href="15018474773088.html">十一、磁盘管理</a></li>
          
            <li><a title="十、用户管理" href="15018399397622.html">十、用户管理</a></li>
          
            <li><a title="九、定时任务" href="15018075128546.html">九、定时任务</a></li>
          
            <li><a title="七、文件属性" href="15017626488369.html">七、文件属性</a></li>
          
            <li><a title="五、Linux基础优化" href="15017614116406.html">五、Linux基础优化</a></li>
          
            <li><a title="八、Linux权限体系" href="15017603199663.html">八、Linux权限体系</a></li>
          
            <li><a title="十九、期中架构NFS知识讲解" href="15013159711138.html">十九、期中架构NFS知识讲解</a></li>
          
            <li><a title="十八、全网备份" href="15013155594594.html">十八、全网备份</a></li>
          
            <li><a title="十七、rsync课程讲解" href="15012425054241.html">十七、rsync课程讲解</a></li>
          
            <li><a title="十六、期中架构" href="15012368281486.html">十六、期中架构</a></li>
          
            <li><a title="六、目录结构" href="15010772533002.html">六、目录结构</a></li>
          
            <li><a title="四、远程连接排错" href="15010763542152.html">四、远程连接排错</a></li>
          
            <li><a title="一、计算机系统硬件核心知识" href="15010712824389.html">一、计算机系统硬件核心知识</a></li>
          
            <li><a title="二、Linux的发展过程与核心知识" href="15010697787307.html">二、Linux的发展过程与核心知识</a></li>
          

      
        <li class="divider"></li>
        <li><label>2.十五个必会的原理知识</label></li>

          
            <li><a title="15. 描述你维护过的大规模集群网站架构的设计原理" href="15010702959683.html">15. 描述你维护过的大规模集群网站架构的设计原理</a></li>
          
            <li><a title="14. 详细描述Linux权限管理体系" href="15010702850667.html">14. 详细描述Linux权限管理体系</a></li>
          
            <li><a title="13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理" href="15010702778892.html">13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理</a></li>
          
            <li><a title="12. 一致性哈西算法作用及原理" href="15010702692268.html">12. 一致性哈西算法作用及原理</a></li>
          
            <li><a title="11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择" href="15010702612275.html">11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择</a></li>
          
            <li><a title="10. Linux默认文件系统,文件删除原理" href="15010702550739.html">10. Linux默认文件系统,文件删除原理</a></li>
          
            <li><a title="09. 详细描述CDN工作原理以及购买服务后解析操作步骤" href="15010702488190.html">09. 详细描述CDN工作原理以及购买服务后解析操作步骤</a></li>
          
            <li><a title="08. keepalive高可用服务工作原理" href="15010702422822.html">08. keepalive高可用服务工作原理</a></li>
          
            <li><a title="07. memcached工作原理(内存管理机制)" href="15010702209182.html">07. memcached工作原理(内存管理机制)</a></li>
          
            <li><a title="06. lvs的4种模式工作原理" href="15010702152705.html">06. lvs的4种模式工作原理</a></li>
          
            <li><a title="05. Nginx配合PHP工作fastcgi工作原理" href="15010702085430.html">05. Nginx配合PHP工作fastcgi工作原理</a></li>
          
            <li><a title="04. MySQL主从同步原理" href="15010701999479.html">04. MySQL主从同步原理</a></li>
          
            <li><a title="03. TCP/IP的三次握手和四次挥手原理" href="15010701936255.html">03. TCP/IP的三次握手和四次挥手原理</a></li>
          
            <li><a title="02. http协议通信原理" href="15010701867065.html">02. http协议通信原理</a></li>
          
            <li><a title="01. DNS系统架构与解析原理" href="15010701752650.html">01. DNS系统架构与解析原理</a></li>
          

      
        <li class="divider"></li>
        <li><label>3.命令总结</label></li>

          
            <li><a title="inotifywait" href="15017603290224.html">inotifywait</a></li>
          
            <li><a title="Linux命令总结 (持续更新中)" href="15013198329902.html">Linux命令总结 (持续更新中)</a></li>
          

      
        <li class="divider"></li>
        <li><label>零散笔记</label></li>

          
            <li><a title="redis简单入门及实现wordpress数据库缓存" href="15052628837678.html">redis简单入门及实现wordpress数据库缓存</a></li>
          
            <li><a title="Linux下获取公网IP地址的方法" href="15051981760993.html">Linux下获取公网IP地址的方法</a></li>
          
            <li><a title="附录: 502和504错误" href="15051451335516.html">附录: 502和504错误</a></li>
          
            <li><a title="HTTP状态码列表" href="15021542293136.html">HTTP状态码列表</a></li>
          
            <li><a title="Ansible常用模块汇总" href="15021011169868.html">Ansible常用模块汇总</a></li>
          
            <li><a title="web服务基础" href="15020372614069.html">web服务基础</a></li>
          
            <li><a title="全网备份案例" href="15010886029579.html">全网备份案例</a></li>
          
            <li><a title="xinetd服务管理器" href="15010578989827.html">xinetd服务管理器</a></li>
          
            <li><a title="服务器简单优化" href="15010516186972.html">服务器简单优化</a></li>
          

      
        <li class="divider"></li>
        <li><label>考试题</label></li>

          
            <li><a title="期中架构之前复习考试" href="15013178849284.html">期中架构之前复习考试</a></li>
          

      
        <li class="divider"></li>
        <li><label>心情随笔</label></li>

          
            <li><a title="鸡汤" href="15050925305457.html">鸡汤</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>1.老男孩学习笔记</span></li>
                        
                          <li><a title="卅七、zabbix自主监控与分布式监控" href="15053046720339.html">卅七、zabbix自主监控与分布式监控</a></li>
                        
                          <li><a title="卅六、zabbix自定义监控" href="15053033256965.html">卅六、zabbix自定义监控</a></li>
                        
                          <li><a title="卅五、centOS6.9部署zabbix" href="15053026350545.html">卅五、centOS6.9部署zabbix</a></li>
                        
                          <li><a title="卅三、PPTP实现VPN" href="15052974923145.html">卅三、PPTP实现VPN</a></li>
                        
                          <li><a title="卅四、openvpn安装与使用" href="15052960182182.html">卅四、openvpn安装与使用</a></li>
                        
                          <li><a title="卅二、NTP时间服务" href="15052921723963.html">卅二、NTP时间服务</a></li>
                        
                          <li><a title="卅一、Keepalived部署" href="15051477961930.html">卅一、Keepalived部署</a></li>
                        
                          <li><a title="三十、Nginx应用--反向代理--负载均衡" href="15051475777273.html">三十、Nginx应用--反向代理--负载均衡</a></li>
                        
                          <li><a title="廿九、数据库迁移--NFS迁移" href="15051466954965.html">廿九、数据库迁移--NFS迁移</a></li>
                        
                          <li><a title="廿八、MySQL基本操作" href="15051459212797.html">廿八、MySQL基本操作</a></li>
                        
                          <li><a title="廿七、单台服务器LNMP搭建" href="15051418147758.html">廿七、单台服务器LNMP搭建</a></li>
                        
                          <li><a title="廿六、Nginx应用--Web服务" href="15051387894730.html">廿六、Nginx应用--Web服务</a></li>
                        
                          <li><a title="卌二、KVM" href="15050197248657.html">卌二、KVM</a></li>
                        
                          <li><a title="卌一、CentOS 7" href="15050196529102.html">卌一、CentOS 7</a></li>
                        
                          <li><a title="四十、自动化安装 (二) -- cobbler" href="15050165021812.html">四十、自动化安装 (二) -- cobbler</a></li>
                        
                          <li><a title="卅九、自动批量的安装操作系统 -- kickstart" href="15050152527420.html">卅九、自动批量的安装操作系统 -- kickstart</a></li>
                        
                          <li><a title="卅八、memcache及session共享" href="15049674009290.html">卅八、memcache及session共享</a></li>
                        
                          <li><a title="廿五、Nginx入门" href="15047113618478.html">廿五、Nginx入门</a></li>
                        
                          <li><a title="廿四、网站访问相关命令" href="15046800151297.html">廿四、网站访问相关命令</a></li>
                        
                          <li><a title="廿三、http协议==超文本传输协议" href="15045988807012.html">廿三、http协议==超文本传输协议</a></li>
                        
                          <li><a title="廿二、ansible" href="15018692235223.html">廿二、ansible</a></li>
                        
                          <li><a title="廿一、远程连接" href="15018686711597.html">廿一、远程连接</a></li>
                        
                          <li><a title="廿十、实时同步服务知识介绍(inotify+rsync)" href="15018676996592.html">廿十、实时同步服务知识介绍(inotify+rsync)</a></li>
                        
                          <li><a title="十五、awk命令精讲" href="15018659093989.html">十五、awk命令精讲</a></li>
                        
                          <li><a title="十四、网络基础" href="15018658919010.html">十四、网络基础</a></li>
                        
                          <li><a title="十三、shell编程入门" href="15018640937342.html">十三、shell编程入门</a></li>
                        
                          <li><a title="十二、sed命令精讲" href="15018613071828.html">十二、sed命令精讲</a></li>
                        
                          <li><a title="十一、磁盘管理" href="15018474773088.html">十一、磁盘管理</a></li>
                        
                          <li><a title="十、用户管理" href="15018399397622.html">十、用户管理</a></li>
                        
                          <li><a title="九、定时任务" href="15018075128546.html">九、定时任务</a></li>
                        
                          <li><a title="七、文件属性" href="15017626488369.html">七、文件属性</a></li>
                        
                          <li><a title="五、Linux基础优化" href="15017614116406.html">五、Linux基础优化</a></li>
                        
                          <li><a title="八、Linux权限体系" href="15017603199663.html">八、Linux权限体系</a></li>
                        
                          <li><a title="十九、期中架构NFS知识讲解" href="15013159711138.html">十九、期中架构NFS知识讲解</a></li>
                        
                          <li><a title="十八、全网备份" href="15013155594594.html">十八、全网备份</a></li>
                        
                          <li><a title="十七、rsync课程讲解" href="15012425054241.html">十七、rsync课程讲解</a></li>
                        
                          <li><a title="十六、期中架构" href="15012368281486.html">十六、期中架构</a></li>
                        
                          <li><a title="六、目录结构" href="15010772533002.html">六、目录结构</a></li>
                        
                          <li><a title="四、远程连接排错" href="15010763542152.html">四、远程连接排错</a></li>
                        
                          <li><a title="一、计算机系统硬件核心知识" href="15010712824389.html">一、计算机系统硬件核心知识</a></li>
                        
                          <li><a title="二、Linux的发展过程与核心知识" href="15010697787307.html">二、Linux的发展过程与核心知识</a></li>
                        

                    
                      <li class="side-title"><span>2.十五个必会的原理知识</span></li>
                        
                          <li><a title="15. 描述你维护过的大规模集群网站架构的设计原理" href="15010702959683.html">15. 描述你维护过的大规模集群网站架构的设计原理</a></li>
                        
                          <li><a title="14. 详细描述Linux权限管理体系" href="15010702850667.html">14. 详细描述Linux权限管理体系</a></li>
                        
                          <li><a title="13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理" href="15010702778892.html">13. 描述Linux下磁盘读写数据的原理，磁盘分区原理，默认文件系统工作原理</a></li>
                        
                          <li><a title="12. 一致性哈西算法作用及原理" href="15010702692268.html">12. 一致性哈西算法作用及原理</a></li>
                        
                          <li><a title="11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择" href="15010702612275.html">11. RAID 0 1 5 10原理、特点、性能区别，集群各角色如何选择</a></li>
                        
                          <li><a title="10. Linux默认文件系统,文件删除原理" href="15010702550739.html">10. Linux默认文件系统,文件删除原理</a></li>
                        
                          <li><a title="09. 详细描述CDN工作原理以及购买服务后解析操作步骤" href="15010702488190.html">09. 详细描述CDN工作原理以及购买服务后解析操作步骤</a></li>
                        
                          <li><a title="08. keepalive高可用服务工作原理" href="15010702422822.html">08. keepalive高可用服务工作原理</a></li>
                        
                          <li><a title="07. memcached工作原理(内存管理机制)" href="15010702209182.html">07. memcached工作原理(内存管理机制)</a></li>
                        
                          <li><a title="06. lvs的4种模式工作原理" href="15010702152705.html">06. lvs的4种模式工作原理</a></li>
                        
                          <li><a title="05. Nginx配合PHP工作fastcgi工作原理" href="15010702085430.html">05. Nginx配合PHP工作fastcgi工作原理</a></li>
                        
                          <li><a title="04. MySQL主从同步原理" href="15010701999479.html">04. MySQL主从同步原理</a></li>
                        
                          <li><a title="03. TCP/IP的三次握手和四次挥手原理" href="15010701936255.html">03. TCP/IP的三次握手和四次挥手原理</a></li>
                        
                          <li><a title="02. http协议通信原理" href="15010701867065.html">02. http协议通信原理</a></li>
                        
                          <li><a title="01. DNS系统架构与解析原理" href="15010701752650.html">01. DNS系统架构与解析原理</a></li>
                        

                    
                      <li class="side-title"><span>3.命令总结</span></li>
                        
                          <li><a title="inotifywait" href="15017603290224.html">inotifywait</a></li>
                        
                          <li><a title="Linux命令总结 (持续更新中)" href="15013198329902.html">Linux命令总结 (持续更新中)</a></li>
                        

                    
                      <li class="side-title"><span>零散笔记</span></li>
                        
                          <li><a title="redis简单入门及实现wordpress数据库缓存" href="15052628837678.html">redis简单入门及实现wordpress数据库缓存</a></li>
                        
                          <li><a title="Linux下获取公网IP地址的方法" href="15051981760993.html">Linux下获取公网IP地址的方法</a></li>
                        
                          <li><a title="附录: 502和504错误" href="15051451335516.html">附录: 502和504错误</a></li>
                        
                          <li><a title="HTTP状态码列表" href="15021542293136.html">HTTP状态码列表</a></li>
                        
                          <li><a title="Ansible常用模块汇总" href="15021011169868.html">Ansible常用模块汇总</a></li>
                        
                          <li><a title="web服务基础" href="15020372614069.html">web服务基础</a></li>
                        
                          <li><a title="全网备份案例" href="15010886029579.html">全网备份案例</a></li>
                        
                          <li><a title="xinetd服务管理器" href="15010578989827.html">xinetd服务管理器</a></li>
                        
                          <li><a title="服务器简单优化" href="15010516186972.html">服务器简单优化</a></li>
                        

                    
                      <li class="side-title"><span>考试题</span></li>
                        
                          <li><a title="期中架构之前复习考试" href="15013178849284.html">期中架构之前复习考试</a></li>
                        

                    
                      <li class="side-title"><span>心情随笔</span></li>
                        
                          <li><a title="鸡汤" href="15050925305457.html">鸡汤</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>廿六、Nginx应用--Web服务</h1>

<ol>
<li><p>nginx多虚拟主机--server{}标签</p>

<blockquote>
<p>在Web服务里独立的网站站点, 对应的是独立的域名或IP或端口</p>
</blockquote>

<ol>
<li><p>测试页面请求响应</p>

<ol>
<li><p>推荐用Linux的curl命令测试</p>

<blockquote>
<p>重启服务后立即生效, 比较准确,不受浏览器缓存的干扰</p>
</blockquote></li>
<li><p>用chrome浏览器查看修改</p>

<blockquote>
<p>需要注意浏览器缓存的干扰导致测试不准确,最好用&quot;隐身窗口&quot;,不进行页面缓存<br/>
<mark>说明：nginx配置文件修改之后，需要重启nginx服务；nginx站点目录内容变更，无需重启nginx服务</mark></p>
</blockquote></li>
</ol></li>
<li><p>基于域名的多虚拟主机配置--多个server{}标签</p>

<ol>
<li><p>环境准备</p>

<blockquote>
<p>模拟环境: <a href="http://www.etiantian.org">www.etiantian.org</a> bbs.etiantian.org blog.etiantian.org</p>
</blockquote>

<pre><code>[root@web01 ~]# mkdir /application/nginx/html/{www,bbs,blog}
[root@web01 ~]# ls /application/nginx/html/
50x.html  bbs  blog  index.html  index.html.bak  pic1.jpg  www
[root@web01 ~]# cd /application/nginx/html/
[root@web01 html]# for name in www bbs blog ; do echo $name `hostname` &gt;/application/nginx/html/$name/index.html;done
[root@web01 html]# for name in www bbs blog ; do cat /application/nginx/html/$name/index.html;done
www web01
bbs web01
blog web01
</code></pre></li>
<li><p>修改配置文件</p>

<pre><code>[root@web01 html]# cd /application/nginx/conf/
[root@web01 conf]# cp nginx.conf{,.ori.www.only}
[root@web01 conf]# vim nginx.conf
:set nu
:10,17co17
:10,17co25
</code></pre>

<blockquote>
<p>修改虚拟主机名, 修改虚拟主机各自的站点目录</p>
</blockquote>

<pre><code>server {
    listen       80;
    server_name  www.etiantian.org;
    location / {
        root   html/www;
        index  index.html index.htm;
    }
}
server {
    listen       80;
    server_name  bbs.etiantian.org;
    location / {
        root   html/blog;
        index  index.html index.htm;
    }
}
server {
    listen       80;
    server_name  blog.etiantian.org;
    location / {
        root   html/bbs;
        index  index.html index.htm;
    }
}
</code></pre></li>
<li><p>配置文件语法检查与重载</p>

<pre><code>[root@web01 conf]# nginx -t
nginx: the configuration file /application/nginx-1.10.3/conf/nginx.conf syntax is ok
nginx: configuration file /application/nginx-1.10.3/conf/nginx.conf test is successful
[root@web01 conf]# nginx -s reload
</code></pre></li>
<li><p>修改Windows hosts文件</p></li>
</ol>

<pre><code>C:\Windows\System32\drivers\etc\hosts
10.0.0.8   www.etiantian.org bbs.etiantian.org blog.etiantian.org
</code></pre></li>
<li><p>基于端口的多虚拟主机配置</p>

<blockquote>
<p>一般用于只想给内部用户访问, 不对外公开(即:不使用默认80端口)</p>
</blockquote>

<ol>
<li><p>修改配置文件</p>

<pre><code>[root@web01 conf]# cp nginx.conf{,.multi-hosts}
[root@web01 conf]# vim nginx.conf
</code></pre>

<blockquote>
<p>修改www端口</p>
</blockquote>

<pre><code>    server {
        listen       8080;
        server_name  www.etiantian.org;
        location / {
            root   html/www;
            index  index.html index.htm;
        }
}
</code></pre></li>
<li><p>语法检查并重载配置</p>

<pre><code>[root@web01 conf]# nginx -t
nginx: the configuration file /application/nginx-1.10.3/conf/nginx.conf syntax is ok
nginx: configuration file /application/nginx-1.10.3/conf/nginx.conf test is successful
[root@web01 conf]# nginx -s reload
[root@web01 conf]# ss -lntup|grep nginx
tcp    LISTEN     0      511                    *:8080                  *:*      users:((&quot;nginx&quot;,1440,10),(&quot;nginx&quot;,6059,10))
tcp    LISTEN     0      511                    *:80                    *:*      users:((&quot;nginx&quot;,1440,6),(&quot;nginx&quot;,6059,6))
</code></pre></li>
</ol></li>
<li><p>基于IP的多虚拟主机配置</p>

<pre><code>    server {
        listen       10.0.0.8:80;
        server_name  www.etiantian.org;
        location / {
            root   html/www;
            index  index.html index.htm;
        }
}
</code></pre>

<blockquote>
<p><mark>注意:基于IP修改配置,用平滑重启不能起效, 需要先stop再启动</mark></p>
</blockquote></li>
<li><p>规范化的nginx配置</p>

<ol>
<li><p>将不同页面的配置分别存放在对应的配置文件中</p>

<pre><code>[root@web01 conf]# cp nginx.conf{,.bak.port}
[root@web01 conf]# cat -n nginx.conf
[root@web01 conf]# mkdir extra
[root@web01 conf]# sed -n &#39;10,17p&#39; nginx.conf &gt;extra/www.conf
[root@web01 conf]# sed -n &#39;18,25p&#39; nginx.conf &gt;extra/bbs.conf
[root@web01 conf]# sed -n &#39;26,33p&#39; nginx.conf &gt;extra/blog.conf
[root@web01 conf]# cat extra/*
</code></pre></li>
<li><p>在主配置文件中引入这些配置</p>

<pre><code>[root@web01 conf]# vim nginx.conf
:10,33delete
[root@web01 conf]# cat nginx.conf
worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    include extra/www.conf;
    include extra/*;
}
[root@web01 conf]# nginx -t
nginx: the configuration file /application/nginx-1.10.3/conf/nginx.conf syntax is ok
nginx: configuration file /application/nginx-1.10.3/conf/nginx.conf test is successful
[root@web01 conf]# nginx -s reload
</code></pre>

<blockquote>
<p><mark>注意: 不可以全都用&quot;extra/*;&quot;代替, *会按字母顺序先匹配到bbs.conf, 但可以先指定www.conf,其他用*代替</mark></p>
</blockquote></li>
</ol></li>
</ol></li>
<li><p>nginx虚拟主机的别名</p>

<ol>
<li><p>修改主页配置</p>

<pre><code>[root@web01 conf]# vim extra/www.conf
    server {
        listen       80;
        server_name  www.etiantian.org etiantian.org;
        location / {
            root   html/www;
            index  index.html index.htm;
        }
    }
</code></pre>

<ol>
<li><p>修改Windows hosts解析</p>

<pre><code>10.0.0.8   www.etiantian.org bbs.etiantian.org blog.etiantian.org etiantian.org
</code></pre></li>
</ol></li>
</ol></li>
<li><p>nginx处理请求的过程</p>

<blockquote>
<p>不指定端口, 只通过域名访问站点时, nginx会通过DNS解析出的IP, 寻找主机80端口在nginx.conf中相对应的第一个网址响应给浏览器(即使不能对应用户想要的域名), 即:配置文件中基于端口的设置优先于基于域名的设置.</p>
</blockquote></li>
<li><p>nginx状态信息功能模块</p>

<blockquote>
<p>nginx -V  ---查看nginx<mark>配置参数和版本</mark></p>
</blockquote>

<ol>
<li><p>编辑状态信息页面配置</p>

<pre><code>[root@web01 conf]# vim extra/status.conf
server {
    listen       80;
    server_name status.etiantian.org;
    location / {
        stub_status on;
        access_log off;
    }
}
</code></pre></li>
<li><p>修改主配置文件</p>

<pre><code>[root@web01 conf]# sed -i.bak.status &#39;/include.*blog/ a include extra/status.conf;&#39; nginx.conf
[root@web01 conf]# cat nginx.conf
worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    include extra/www.conf;
    include extra/bbs.conf;
    include extra/blog.conf;
include extra/status.conf;
}
</code></pre></li>
<li><p>配置文件语法检查与重载</p>

<pre><code>[root@web01 conf]# nginx -t
nginx: the configuration file /application/nginx-1.10.3/conf/nginx.conf syntax is ok
nginx: configuration file /application/nginx-1.10.3/conf/nginx.conf test is successful
[root@web01 conf]# nginx -s reload
</code></pre></li>
<li><p>修改Windows hosts解析</p>

<pre><code>10.0.0.8   status.etiantian.org etiantian.org www.etiantian.org bbs.etiantian.org blog.etiantian.org
</code></pre></li>
</ol></li>
<li><p>nginx如何查看并发数?</p>

<ol>
<li><p>使用状态模块</p>

<blockquote>
<p>官方手册:<a href="http://nginx.org/en/docs/http/ngx_http_stub_status_module.html">http://nginx.org/en/docs/http/ngx_http_stub_status_module.html</a><br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/57823511.jpg" alt=""/></p>

<pre><code>Active connections
The current number of active client connections including Waiting connections.
accepts
The total number of accepted client connections.
handled
The total number of handled connections. Generally, the parameter value is the same as accepts unless some resource limits have been reached (for example, the worker_connections limit).
requests
The total number of client requests.
Reading
The current number of connections where nginx is reading the request header.
Writing
The current number of connections where nginx is writing the response back to the client.
Waiting
The current number of idle client connections waiting for a request.
</code></pre>

<p><img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/10186457.jpg" alt=""/></p>
</blockquote></li>
<li><p>ss -ant|grep -ic estab</p>

<pre><code>[root@web01 conf]# ss -ant|grep -i estab
ESTAB      0      64                 10.0.0.8:22                10.0.0.1:50152
ESTAB      0      0                  10.0.0.8:22                10.0.0.1:50923
[root@web01 conf]# ss -ant|grep -ic estab
2
</code></pre></li>
</ol></li>
<li><p>nginx访问日志</p>

<ol>
<li><p>定义日志的格式与使用方法</p>

<pre><code>[root@web01 conf]# grep -A4 &#39;log_format&#39; nginx.conf.default
    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    #access_log  logs/access.log  main;
[root@web01 conf]#
</code></pre>

<ol>
<li><p>编辑主配置文件</p>

<pre><code>[root@web01 conf]# vim nginx.conf
[root@web01 conf]# cat nginx.conf
worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  logs/access.log  main; 
    include extra/www.conf;
    include extra/bbs.conf;
    include extra/blog.conf;
    include extra/status.conf;
}
</code></pre>

<blockquote>
<p><mark>说明: 在配置文件中正确定义了日志文件并成功启动nginx之后, 即使日志文件以前不存在也会被创建出来</mark></p>
</blockquote></li>
<li><p>语法检查与重载</p>

<pre><code>[root@web01 conf]# nginx -t
nginx: the configuration file /application/nginx-1.10.3/conf/nginx.conf syntax is ok
nginx: configuration file /application/nginx-1.10.3/conf/nginx.conf test is successful
[root@web01 conf]# nginx -s reload
</code></pre></li>
<li><p>刷新页面并检查日志</p></li>
</ol>

<pre><code>[root@web01 conf]# tail ../logs/access.log
</code></pre></li>
<li><p>日志格式分析</p>

<blockquote>
<p>$remote_addr 远端用户ip地址<br/>
$remote_user 远端用户,默认为空,需要指定<br/>
[$time_local] 服务器本地时间<br/>
$request 请求的起始行---(http请求方法  URI  http协议版本)<br/>
注意:nginx中的URI指的是一个完整网址的顶级域名后面的部分<br/>
$status 状态码<br/>
$body_bytes_sent 响应主体大小--byte<br/>
$http_referer 访问方式(连接跳转 或 域名访问)<br/>
$http_x_forwarded_for 反向代理相关<br/>
$http_user_agent 浏览器软件版本<br/>
说明=====浏览器UA 字串的标准格式为:<br/>
浏览器标识 (操作系统标识; 加密等级标识; 浏览器语言) 渲染引擎标识 版本信息<br/>
在chrome浏览器中, 使用F12打开调试模式, 可以模拟智能终端访问</p>
</blockquote>

<pre><code>10.0.0.1 - - [09/Aug/2017:12:02:52 +0800] &quot;GET / HTTP/1.1&quot; 200 10 &quot;-&quot; &quot;Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Mobile Safari/537.36&quot; &quot;-&quot;
10.0.0.1 - - [09/Aug/2017:01:51:16 +0800] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36&quot; &quot;-&quot;
10.0.0.1 - - [09/Aug/2017:09:27:15 +0800] &quot;GET /favicon.ico HTTP/1.1&quot; 404 571 &quot;http://www.etiantian.org/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36&quot; &quot;-&quot;
</code></pre></li>
</ol></li>
<li><p>日志操作</p>

<ol>
<li><p>压缩日志</p>

<pre><code>access_log  logs/access.log  main gzip buffer=32k flush=5s;
</code></pre>

<blockquote>
<p>查看日志内容命令 zcat zgrep zless</p>
</blockquote></li>
<li><p>手动切割</p>

<blockquote>
<p>注意切割周期</p>
</blockquote>

<pre><code>[root@web01 logs]# mv access.log access_`date -d &quot;-1day&quot; +%F`.log
[root@web01 logs]# ls
access_2017-07-29.log  error.log  nginx.pid
[root@web01 logs]# /application/nginx/sbin/nginx -s reload
[root@web01 logs]# ls
access_2017-07-29.log access.log  error.log  nginx.pid
</code></pre></li>
<li><p>定时任务脚本切割</p>

<blockquote>
<p>通过脚本的方式来实现切割。通过计划任务</p>

<pre><code>vim /server/scripts/cut_nginx_log.sh
#!bin/sh
#nginx目录
Basedir=&quot;/application/nginx&quot;
#日志目录
Nginxlogdir=&quot;$Basedir/logs&quot;
#当天日志文件名前缀
Logname=&quot;access&quot;
#切割后的文件名中的时间格式
Dateformat=`date -d &quot;yesterday&quot; +%Y-%m-%d`
#判断nginx目录是否存在
[ -d $Nginxlogdir ]&amp;&amp; cd $Nginxlogdir||exit 1
#判断nginx是否启动
[ -f ${Nginxlogdir}/nginx.pid ]||exit 1
#判断日志文件是否存在
[ -f ${Logname}.log ]||exit 1
#重命名日志文件==切割
/bin/mv ${Logname}.log ${Dateformat}_${Logname}.log
#向 Nginx 的进程发送 USR1 信号以重新打开日志文件
kill -USR1 $(cat ${Nginxlogdir}/nginx.pid)
</code></pre>

<p>必须向 Nginx 的进程发送 USR1 信号以重新打开日志文件，如果不写的话，Nginx 会继续将日志信息写入 access_[yyyy-MM-dd].log 的那个文件中，这显然是不正确的。</p>
</blockquote>

<pre><code>#nginx日志切割
0 0 * * * /bin/bash /server/scripts/cut_nginx_log.sh &amp;&gt;/dev/null
</code></pre></li>
<li><p>loglocate日志轮询切割</p>

<pre><code>[root@web01 nginx]# vim /etc/logrotate.d/nginx
/application/nginx/logs/access.log /application/nginx/logs/error.log{
notifempty
daily
sharedscripts;
postrotate
/bin/kill -USR1 `/bin/cat /application/nginx/logs/nginx.pid`
endscript
}
</code></pre></li>
</ol></li>
<li><p>location请求定位</p>

<blockquote>
<p>作用是<br/>
官方文档: <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location">http://nginx.org/en/docs/http/ngx_http_core_module.html#location</a><br/>
语法location [ = | ~ | ~* | <sup>~</sup> ] uri { ... }<br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/83152961.jpg" alt=""/></p>
</blockquote>

<ol>
<li><p>匹配字符串</p>

<blockquote>
<p>&quot;=&quot; 完全匹配(精确)<br/>
&quot;<sup>~&quot;</sup> 常规匹配, 不检查正则表达式<br/>
&quot;~<em>&quot; 不区分大小写, 可以用正则和!取反<br/>
&quot;~&quot; 区分大小写, 可以用正则!取反<br/>
&quot; &quot; 不指定表示匹配不到有效位置时最后的匹配<br/>
优先级: &quot;=&quot; &gt; &quot;<sup>~&quot;</sup> &gt; &quot;~</em>&quot; &gt; &quot;~&quot; &gt; &quot; &quot;(默认)</p>
</blockquote></li>
<li><p>匹配变量</p>

<blockquote>
<p>官网: <a href="http://nginx.org/en/docs/varindex.html">http://nginx.org/en/docs/varindex.html</a><br/>
常见变量: $request_uri</p>
</blockquote></li>
<li><p>allow和deny</p>

<pre><code>        location ~* /AV/ {
            root   html/www/AV/;
            index  index.html index.htm;
            allow  172.16.1.31/32;
            deny   all;
        }
</code></pre></li>
</ol></li>
<li><p>rewrite重写URI(用于伪静态)</p>

<ol>
<li><p>用途</p>

<blockquote>
<p><a href="http://oldboy.blog.51cto.com/2561410/1774260">http://oldboy.blog.51cto.com/2561410/1774260</a><br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/49779301.jpg" alt=""/></p>
</blockquote></li>
<li><p>用法</p>

<blockquote>
<p>语法格式: rewrite RegEx replacement [flag];<br/>
相当于: sed &#39;s#RegEx#replacement#g&#39;<br/>
应用位置: server区块 location区块 if区块</p>
</blockquote></li>
<li><p>Perl正则: (.*)--$n<br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/2480791.jpg" alt=""/><br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/98781645.jpg" alt=""/></p></li>
<li><p>if区块用法</p>

<blockquote>
<p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if</a><br/>
Example:<br/>
if ($slow) {<br/>
    limit_rate 10k;<br/>
    break;<br/>
}<br/>
Syntax: if (condition) { ... }<br/>
Default:    —<br/>
Context:    server, location</p>
</blockquote></li>
<li><p><a href="http://www.conf%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%86%99%E6%B3%95">www.conf第一种写法</a></p>

<pre><code>   server {
        listen         80;
        server_name  www.etiantian.org  etiantian.org ;
        if ($host ~* &quot;^etiantian.org$&quot;) {
        rewrite ^/(.*) http://www.etiantian.org/$1 permanent;
        }
        location / {
            root   html/www;
            index  index.html index.htm;
        }
}
</code></pre></li>
<li><p><a href="http://www.conf%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95">www.conf第二种写法</a></p>

<pre><code>   server {
        listen   80;
        server_name etiantian.org ;
        rewrite ^/(.*) http://www.etiantian.org/$1 permanent;
         }
   server {
        listen   80;
        server_name  www.etiantian.org;
        location / {
            root   html/www;
            index  index.html index.htm;
        }
}
</code></pre></li>
</ol></li>
<li><p>Nginx基本认证功能</p>

<pre><code>yum install -y httpd-tools
htpasswd -bc /application/nginx/conf/htpasswd oldboy 123456
chmod 400 /application/nginx/conf/htpasswd
chown www.www /application/nginx/conf/htpasswd
</code></pre>

<blockquote>
<p>有效的配置代码:<br/>
<img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/42809116.jpg" alt=""/></p>
</blockquote>

<blockquote>
<p>修改status.conf作为测试</p>
</blockquote>

<pre><code>server{
    listen  80;
    server_name  status.etiantian.org;
    location / {

    ## status module
    stub_status on;
    access_log   off;

    ## auth module
    auth_basic &quot;root only&quot;;
    auth_basic_user_file /application/nginx/conf/htpasswd;
    }
}
</code></pre>

<p><img src="http://ovt17vn7k.bkt.clouddn.com/17-9-11/38166362.jpg" alt=""/></p></li>
<li><p>补充:</p>

<ol>
<li><p>403错误的两种可能情况</p>

<blockquote>
<p>首页文件名不正确<br/>
配置文件阻止策略</p>
</blockquote></li>
<li><p>autoindex自动索引</p>

<blockquote>
<p>首页文件不存在时,如果设置 autoindex on;浏览器就会将站点目录结构解析出来</p>
</blockquote></li>
<li><p>304的含义</p>

<pre><code>10.0.0.1 - - [10/Aug/2017:11:19:38 +0800] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36&quot; &quot;-&quot;
</code></pre>

<blockquote>
<p>意味着浏览器使用了缓存来访问站点<br/>
使用Ctrl+F5强制刷新,不使用缓存记录</p>
</blockquote></li>
</ol></li>
</ol>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15051418147758.html"  title="Previous Post: 廿七、单台服务器LNMP搭建">&laquo; 廿七、单台服务器LNMP搭建</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15050925305457.html" 
	        title="Next Post: 鸡汤">鸡汤 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15051387894730.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
